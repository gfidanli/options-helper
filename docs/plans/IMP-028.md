# IMP-028 — Corporate actions + news ingestion (Alpaca) for event-aware analytics

- **Status:** done
- **Effort:** M
- **Alpha potential:** Medium–High

## Summary
Add optional ingestion for **corporate actions** (splits, dividends, mergers/spinoffs where available) and **news**.
These are “feature enablers” that help explain large moves, improve backtest realism, and support future alerting / journaling.

This IMP is intentionally additive: it introduces stores + fetchers and a minimal CLI refresh path.

## Goals
- Add a `CorporateActionsStore` that can cache corporate actions for symbols over a date range.
- Add a `NewsStore` that can cache news articles for symbols over a date range.
- Add Alpaca client wrappers for both endpoints, including pagination and stable schemas.
- Provide at least one CLI refresh command for each store.

## Non-goals
- Sentiment analysis or summarization of news (future feature).
- Rewriting candle adjustment logic (already handled by Alpaca `adjustment` in IMP-022).
- A full “event calendar” UI—just data ingestion and caching.

## User-facing changes
- New CLI commands (proposed):
  - `options-helper events refresh-corporate-actions --symbols ... --start ... --end ...`
  - `options-helper events refresh-news --symbols ... --start ... --end ...`
- New data dirs:
  - `data/events/corporate_actions/<SYMBOL>.json`
  - `data/events/news/<SYMBOL>/<YYYY-MM-DD>.jsonl.gz` (or partitioned by day)

## Design
### Corporate actions
- Use Alpaca’s Corporate Actions API via `alpaca.data.historical.corporate_actions.CorporateActionsClient`.
- Normalize events into a simple table with:
  - `type` (split/dividend/merger/spinoff/etc.)
  - `symbol`
  - `ex_date` / `record_date` / `pay_date` where present
  - `ratio` (for splits) or `cash_amount` (for dividends)
  - raw payload preserved

### News
- Use `alpaca.data.historical.news.NewsClient` + `NewsRequest`.
- Handle pagination (page_token) and store:
  - `id`, `created_at`, `headline`, `summary`, `source`, `symbols`
  - optionally `content` (guarded behind a flag due to size)

### Schema versioning
- Use the repo’s pattern from IMP-014:
  - `schema_version`
  - `generated_at` / `fetched_at`
  - request meta

## Implementation plan
### Step 1 — Add stores
**Files:**
- `options_helper/data/corporate_actions_store.py` (new)
- `options_helper/data/news_store.py` (new)

**Work:**
- Create stable, versioned JSON/JSONL schemas.
- Implement save/load/query helpers.

### Step 2 — Add Alpaca client wrappers
**Files:**
- `options_helper/data/alpaca_client.py`

**Work:**
- `get_corporate_actions(symbols, *, start, end, types, limit) -> list[dict]`
- `get_news(symbols, *, start, end, include_content, limit) -> list[dict]`
- Handle pagination robustly.

### Step 3 — Add CLI refresh commands
**Files:**
- `options_helper/cli.py`

**Work:**
- Add `events` command group with:
  - `refresh_corporate_actions`
  - `refresh_news`
- Each command writes to its store and prints a small summary.

## Tests
- `tests/events/test_corporate_actions_store.py`
- `tests/events/test_news_store.py`
- provider wrapper tests ensuring pagination is followed and normalized schema is produced.

## Acceptance criteria
- Can refresh corporate actions and news for a symbol over a date range and read them back.
- No impact on existing workflows unless the new CLI commands are invoked.
