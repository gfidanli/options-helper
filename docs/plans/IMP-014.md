# IMP-014 — Artifact data contracts (schema-versioned JSON + validation)

- **Status:** ready
- **Effort:** M
- **Alpha potential:** Medium

## Summary
Make all machine-readable artifacts produced by the CLI **schema-versioned and validated** so that:
- agents can rely on stable fields,
- regressions are caught by tests,
- historical artifacts remain parseable across refactors.

## Goals
- Every command that writes JSON includes:
  - `schema_version`
  - `generated_at`
  - `as_of` (data date)
- Provide Pydantic models for each JSON artifact.
- Add a validation step in tests and (optionally) at runtime with `--strict`.

## Non-goals
- Validating CSV snapshots (start with JSON artifacts first).

## User-facing changes
- JSON outputs are more structured and stable.
- `--strict` on relevant commands fails fast if an artifact can’t be produced with required fields.

## Design
### Scope (v1)
Target the JSON artifacts that are explicitly meant for agents:
- briefing (`data/reports/daily/*.json`)
- chain-report JSON (if present)
- compare JSON
- flow JSON
- scanner shortlist JSON

### Versioning
- Start each artifact at `schema_version = 1`.
- When breaking a contract, bump version and keep the old reader if feasible.

## Implementation plan
### Step 1 — Create `options_helper/schemas/`
**Files:**
- `options_helper/schemas/__init__.py` (new)
- `options_helper/schemas/<artifact>.py` (new)

**Work:**
- Define Pydantic models for each artifact.
- Provide `to_dict()` helpers and `model_validate` loading helpers.

### Step 2 — Wire into writers
**Files:**
- `options_helper/reporting_briefing.py`
- `options_helper/cli.py` (where artifacts are written)

**Work:**
- Ensure every JSON write uses the schema model.
- Include `schema_version`, `generated_at`, `as_of` in the root.

### Step 3 — Add golden fixtures
**Files:**
- `tests/fixtures/artifacts/` (new)

**Work:**
- For each artifact, commit one small fixture JSON.
- Add tests that validate current outputs match schema (and optionally match golden for key fields).

### Step 4 — Docs
**Files:**
- `docs/ARTIFACT_SCHEMAS.md` (new)

## Tests
- Schema validation tests for each artifact.
- CLI tests ensure JSON can be produced offline.

## Acceptance criteria
- Agents can parse JSON artifacts without spelunking Markdown.
- Breaking changes require an explicit schema version bump.
