# IMP-008 — Multi-factor scanner ranking

- **Status:** ready
- **Effort:** M–L
- **Alpha potential:** Med–High

## Summary
Upgrade the scanner from “extension tails only” to a multi-factor ranking engine that combines extension percentile with momentum context, liquidity, volatility regime, and optional flow history. The goal is a smaller, higher-quality shortlist.

## Goals
- Produce a `scanner score` per symbol based on multiple signals.
- Keep factors explainable and configurable.
- Preserve existing scanner pipeline (prefilter → extension scan → snapshot → liquidity filtering) while adding a ranking layer.

## Non-goals
- ML ranking models.
- Intraday scanning.

## User-facing changes
- Shortlist artifact gains columns:
  - `score`, `coverage`, `top_reasons`
- Output is sorted by `score` by default.

## Design
### Candidate factors (v1)
- Extension tail severity (farther into tail → higher score)
- Weekly trend alignment (trend up/down)
- RSI divergence (penalize divergence against trend)
- Liquidity health (contracts/expiries passing gates)
- Vol regime (IV/RV; if available from derived)
- Optional: recent flow alignment if snapshots exist (ΔOI notional)

### Control knobs
- All weights/thresholds live in a config file (can reuse IMP-003 confluence config).

## Implementation plan
### Step 1 — Add ranking function
**Files:**
- `options_helper/analysis/scanner_rank.py` (new) OR reuse `analysis/confluence.py`

**Work:**
- Implement `rank_scanner_candidate(inputs, cfg) -> score + reasons`.

### Step 2 — Integrate into scanner pipeline
**Files:**
- `options_helper/data/scanner.py`
- `options_helper/cli.py` (scanner command)

**Work:**
- After extension scan and (optional) snapshot/liquidity checks, compute score and add to output rows.
- Sort shortlist by score.

### Step 3 — Artifacts
**Files:**
- `docs/SCANNER.md`

**Work:**
- Document factors and how to tune weights.

### Step 4 — Tests
**Files:**
- `tests/test_scanner_cli.py` (extend)
- new unit tests for ranking

**Work:**
- Use fixtures so scoring is deterministic.

## Acceptance criteria
- Scanner produces a ranked shortlist with explainable reasons.
- With all inputs missing, scanner behaves like today (extension-only) but still runs.
